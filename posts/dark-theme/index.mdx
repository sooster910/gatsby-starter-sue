---
title: [Gatsby darkmode] ê°œì¸ ë¹„ ë‹¤í¬ëª¨ë“œ ì ìš©ì´ ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ
slug: dark-theme
author: Hyunsu Joo
published: 2021-12-02
lastUpdated: 2021-12-02
draft: false
image: ./darkmode.png
imageAlt: darkmode
tags: ['gatsby']
---

<img width="664" alt="General 2021-12-02 16-18-43" src="https://user-images.githubusercontent.com/26635607/144375957-e7c98c74-754f-4b4f-b265-ec3e462641cb.png">

ìœ„ì˜ ì‚¬ì§„ì€ ë§¥ ê¸°ì¤€ì˜ ì‹œìŠ¤í…œ ì„¤ì •ì…ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ì´ë ‡ê²Œ ë³´ì—¬ì§ˆ ë·°ë¥¼ light ë˜ëŠ” darkëª¨ë“œë¡œ ì„ íƒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì œ ë¸”ë¡œê·¸ë¥¼ ë°©ë¬¸í•˜ëŠ” ì‚¬ëŒë“¤ì—ê²Œ ë¯¸ë¦¬ ì‚¬ìš©ìê°€ ì ìš©í•œ ì„¤ì •ì— ë§ì¶”ì–´ ë·°ë¥¼ ì œê³µí•œë‹¤ë©´ ë” ë‚˜ì€ ì‚¬ìš©ì ê²½í—˜ì„ ì „ë‹¬ í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

## ë‹¤í¬ ëª¨ë“œ ê¸°ë³¸ ë¡œì§

- ì´ë¯¸ ë¸”ë¡œê·¸ í˜ì´ì§€ì— ë°©ë¬¸í•œ ì ì´ ìˆë‹¤ë©´ â†’ localstorage ì˜ theme ê°’ ì ìš©.
- ì²˜ìŒ ë°©ë¬¸í•˜ì˜€ê³ , ì‚¬ìš©ìì˜ **ìš´ì˜ ì²´ì œ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ë‹¤í¬ëª¨ë“œê°€ ë˜ì–´ ìˆëŠ” ê²½ìš°** â†’ ì‚¬ìš©ìì˜ ìš´ì˜ ì²´ì œ ê¸°ë³¸ ê°’ìœ¼ë¡œ ì ìš©.

## ì´ìŠˆ

í•˜ì§€ë§Œ ë‹¤í¬ëª¨ë“œê°€ ì ìš©ì´ ë˜ì§ˆ ì•ŠëŠ” í˜„ìƒì´ ë°œìƒí•©ë‹ˆë‹¤.ì´ëŠ”
ë¹Œë“œ í›„ ì •ì íŒŒì¼ì´ ìƒì„±ë˜ì—ˆì„ë•Œ productioní™˜ê²½ ì—ì„œëŠ” localStorageì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ì—¬ ì‚¬ìš©ìì˜ ì¸í„°ë ‰ì…˜ì— ë”°ë¼ í…Œë§ˆê°€ ë°”ë€Œì§€ ì•ŠëŠ” ì´ìŠˆì…ë‹ˆë‹¤.

## ì´ìŠˆì˜ ì›ì¸

gatsbyì—ì„œëŠ” hydrate ê³¼ì •ì„ ê±°ì¹˜ëŠ”ë° ì¦‰ ë¹Œë“œ í›„ ì„œë²„ì¸¡ì—ì„œ ì •ì íŒŒì¼ì„ ì œê³µí•˜ê³  í´ë¼ì´ì–¸íŠ¸ì¸¡ì—ì„  ì •ì íŒŒì¼ì„ ë Œë”ë§ í›„ ë¦¬ì•¡íŠ¸ì™€ ìƒíƒœë¥¼ ê·¸ë ¤ë‚´ ë‹¤ì‹œ ë™ì ì¸ ì•±ì„ ë Œë”ë§ í•©ë‹ˆë‹¤.  
dark mode ë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ì„  ìµœì´ˆ ë Œë”ë§ì´ ë˜ê¸° ì „ì— local storageì— ì ‘ê·¼í•˜ê±°ë‚˜ ë˜ëŠ” ì‚¬ìš©ìì˜ í™˜ê²½ì— ì ‘ê·¼í•˜ì—¬ theme ê°’ì„ ê°€ì ¸ì™€ì•¼ í•˜ëŠ”ë° ë¨¼ì € ë Œë”ë§ì´ ì¼ì–´ë‚˜ê³  rehydrateì´ ì¼ì–´ë‚˜ê¸° ë•Œë¬¸ì—, ê¹œë¹¡ì„ì´ ìƒê¸°ê±°ë‚˜ ì›í•˜ëŠ” ê°’ì„ ë¯¸ë¦¬ ê°€ì ¸ì˜¤ì§€ ëª»í•˜ëŠ” ì´ìŠˆê°€ ìƒê¹ë‹ˆë‹¤.

## í•´ê²° ì ‘ê·¼

**HTML í˜ì´ì§€ê°€**Â ë¸Œë¼ìš°ì €ì— ì˜í•´Â **êµ¬ë¬¸ ë¶„ì„ë˜ê³  ë Œë”ë§ë˜ê¸° ì „ì— ì‹¤í–‰í• **Â í…Œë§ˆë¥¼ ì„ íƒí•˜ëŠ” ì½”ë“œê°€ í•„ìš” í•©ë‹ˆë‹¤.

gatsbyì—ì„  ì§ì ‘ì ìœ¼ë¡œ html ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, **Customizing html.js íŒŒì¼ì„ ì´ìš©í•©ë‹ˆë‹¤.**

`/src/html.js`

<img width="846" alt="html js â€” gatsby-starter-blog-sue 2021-11-27 18-47-17" src="https://user-images.githubusercontent.com/26635607/144374332-60adfcfe-a432-4136-8632-12c5ea3da646.png">

HTMLí˜ì´ì§€ê°€ ë Œë”ë§ ë  ë•Œ ì´ ì½”ë“œë² ì´ìŠ¤ë„ ê°™ì´ íŒŒì‹±ì´ ë˜ë©´ì„œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë¡œ ì ‘ê·¼ì„ í•˜ê³ ,

window ì „ì—­ ê°ì²´ì— themeì„ ì„¸íŒ… í•©ë‹ˆë‹¤. ìµœì´ˆ ë Œë”ë§ì‹œ theme ì„ ì•Œ ìˆ˜ ìˆê²Œ `<body>` íƒœê·¸ì— classë¡œ themeì„ ì§€ì •í•©ë‹ˆë‹¤. `window.matchMedia('(prefers-color-scheme)')` ì„ ì´ìš©í•˜ì—¬ ì‚¬ìš©ì ìš´ì˜ì²´ì œ ê¸°ë³¸ì„¤ì •ì˜ themeì— ì ‘ê·¼ í›„ windowê°ì²´ì— themeì„ ì„¸íŒ…í•©ë‹ˆë‹¤.

ë¦¬ì•¡íŠ¸ ê¸°ë°˜ì½”ë“œì—ì„œëŠ” `context API`ì™€ `UseReducer` í›…ì„ ì´ìš©í•˜ì—¬ themeì„ ì „ì—­ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•˜ì˜€ìŠµë‹ˆë‹¤.

useReducerì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ìµœì´ˆê°’ì„ ê°€ì ¸ì˜¬ì‹œ ìœ„ì—ì„œ ì €ì¥í•œ `window.__theme` ê°ì²´ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img width="422" alt="GlobalContextProvider tsx â€” gatsby-starter-blog-sue 2021-11-27 19-10-25" src="https://user-images.githubusercontent.com/26635607/144374951-67702475-e3e6-4f20-b1b8-6b55ad64b9f1.png">

ë¦¬ë“€ì„œë¥¼ í™œìš©í•˜ì—¬ ì•¡ì…˜ íƒ€ì…ì— ë”°ë¼ themeìŠ¤ìœ„ì¹˜ ë²„íŠ¼ í† ê¸€ì‹œ window ê°ì²´ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì—¬ themeì„ ì €ì¥í•©ë‹ˆë‹¤.

<img width="652" alt="GlobalContextProvider tsx â€” gatsby-starter-blog-sue 2021-11-27 19-13-50" src="https://user-images.githubusercontent.com/26635607/144374957-222cdd5d-389d-4942-a5ea-c55227b0ff8e.png">

html.jsì—ì„œ ì§€ì •í•œ bodyíƒœê·¸ì˜ class nameì„ ê¸°ì¤€ìœ¼ë¡œ css variableì„ ì´ìš©í•˜ì—¬ themeì„ ì§€ì •í•©ë‹ˆë‹¤. css variableì„ ì´ìš©í•˜ë©´ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì¤‘ì—ë„ ë³€ìˆ˜ê°’ì˜ ë³€ê²½ì— ë™ì ìœ¼ë¡œ ìŠ¤íƒ€ì¼ì„ ë°”ë¡œ ë³€ê²½ì„ í•  ìˆ˜ ìˆëŠ” ì´ì ì´ ìˆìŠµë‹ˆë‹¤.

<img width="409" alt="GlobalStyles tsx â€” gatsby-starter-blog-sue 2021-11-27 19-16-56" src="https://user-images.githubusercontent.com/26635607/144374959-fa672f83-892f-4474-aedc-9097538cd211.png">

ì „ì²´ ì½”ë“œ ì…ë‹ˆë‹¤.

context API ì •ì˜ í•©ë‹ˆë‹¤.

```tsx
import { useReducer, createContext, Dispatch, useContext } from 'react'
import { ThemeProvider } from '@emotion/react'
import GlobalStyles from '../styles/GlobalStyles'
import theme from '../styles/theme'

type State = {
  isDark?: string
  theme: string
}
type Action = { type: 'TOGGLE_DARK_MODE'; theme: string }
type SampleDispatch = Dispatch<Action>

export const GlobalStateContext = createContext<State | null>(null)
export const GlobalDispatchContext = createContext<SampleDispatch | null>(null)
declare global {
  interface Window {
    __theme: string
    __setPreferredTheme: (toggleTheme: string) => void
  }
}

const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case 'TOGGLE_DARK_MODE': {
      const toggledTheme = window.__theme === 'dark' ? 'light' : 'dark'
      window.__setPreferredTheme(toggledTheme)
      return {
        theme: toggledTheme,
      }
    }

    default:
      return state
  }
}

const initializeState = () => {
  if (typeof window !== 'undefined') {
    return {
      theme: window.__theme,
    }
  } else {
    return { theme: 'light' }
  }
}

const initialState: State = {
  theme: 'light',
}

const GlobalContextProvider = ({ children }: { children: React.ReactNode }) => {
  const [state, dispatch] = useReducer(reducer, initialState, initializeState)

  if (state) {
    return (
      <GlobalStateContext.Provider value={state}>
        <GlobalDispatchContext.Provider value={dispatch}>
          <ThemeProvider
            theme={state.theme === 'light' ? theme.light : theme.dark}
          >
            <GlobalStyles />
            {children}
          </ThemeProvider>
        </GlobalDispatchContext.Provider>
      </GlobalStateContext.Provider>
    )
  }
}

export default GlobalContextProvider

export function useThemeState() {
  const state = useContext(GlobalStateContext)
  if (!state) throw new Error('Cannot find GlobalStateProvider')
  return state
}

export function useThemeDispatch() {
  const dispatch = useContext(GlobalDispatchContext)
  if (!dispatch) throw new Error('Cannot find GlobalStateProvider') // ìœ íš¨í•˜ì§€ ì•Šì„ë• ì—ëŸ¬ë¥¼ ë°œìƒ
  return dispatch
}
```

`src/html.js`

```javascript
import React from 'react'
import PropTypes from 'prop-types'

export default function HTML(props) {
  return (
    <html {...props.htmlAttributes}>
      <head>
        <meta charSet="utf-8" />
        <meta httpEquiv="x-ua-compatible" content="ie=edge" />
        <meta
          name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        {props.headComponents}
      </head>
      <body {...props.bodyAttributes} className="light">
        <script
          dangerouslySetInnerHTML={{
            __html: `
              (() => {
                let preferredTheme;
                try {
                  preferredTheme = localStorage.getItem('theme');
                } catch (err) {}
                const setTheme = (newTheme) => {
                  window.__theme = newTheme;
                  preferredTheme = newTheme;
                  document.body.className = newTheme;
                }
                window.__setPreferredTheme = (newTheme) => {
                  setTheme(newTheme);
                  try {
                    localStorage.setItem('theme', newTheme);
                  } catch (err) {}
                }
                let darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
                darkQuery.addListener(e => {
                  window.__setPreferredTheme(e.matches ? 'light' : 'dark');
                })
                setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
              })();
            `,
          }}
        />
        {props.preBodyComponents}
        <div
          key={`body`}
          id="___gatsby"
          dangerouslySetInnerHTML={{ __html: props.body }}
        />
        {props.postBodyComponents}
      </body>
    </html>
  )
}

HTML.propTypes = {
  htmlAttributes: PropTypes.object,
  headComponents: PropTypes.array,
  bodyAttributes: PropTypes.object,
  preBodyComponents: PropTypes.array,
  body: PropTypes.string,
  postBodyComponents: PropTypes.array,
}
```

`src/header.tsx` - ë‹¤í¬ëª¨ë“œ ìŠ¤ìœ„ì¹˜ ë²„íŠ¼ì´ ìˆëŠ” component

buttonì˜ onClick ì´ë²¤íŠ¸ëŠ” `setToggleTheme` ì˜ í•¨ìˆ˜ì˜ ì¼ì¸  
`TOGGLE_DARK_MODE` ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜ í•©ë‹ˆë‹¤. ì¦‰ ë¦¬ë“€ì„œì— ì•½ì†ë˜ì–´ì§„
`TOGGLE_DARK_MODE` ì•¡ì…˜ì„ ì‹¤í–‰ì‹œì¼œ themeì„ ì „í™˜í•©ë‹ˆë‹¤.

`useThemeState()` ë¥¼ ì´ìš©í•˜ì—¬ ì „ì—­ ìƒíƒœì¸ theme ìƒíƒœë¥¼ ë°›ì•„ì™€ì„œ ìƒíƒœ ê°’ì— ë”°ë¼ ì•„ì´ì½˜ì„ ë³€ê²½í•©ë‹ˆë‹¤.

```tsx
const Header = ({ siteTitle }: HeaderProps): React.ReactElement => {
  const dispatch = useThemeDispatch()
  const state = useThemeState()
  const setToggleTheme = () => dispatch({ type: 'TOGGLE_DARK_MODE', theme: '' })
  return (
    <header>
      <button onClick={setToggleTheme}>
        <Twemoji
          emoji={state?.theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ“'}
          css={css`
            width: 24px;
          `}
        />
      </button>
    </header>
  )
}

export default Header
```

---

ì°¸ê³ ìë£Œ

- [The Quest For the Perfect Dark Mode](https://www.joshwcomeau.com/react/dark-mode/)
- [Gatsby ê³µì‹ë¬¸ì„œ customizing html.js](https://www.gatsbyjs.com/docs/custom-html/)
